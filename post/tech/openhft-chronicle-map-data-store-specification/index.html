<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Openhft Chronicle Map Data Store Specification</title><meta name=description content><meta name=generator content="Hugo 0.49"><meta property=og:title content="Openhft Chronicle Map Data Store Specification"><meta property=og:description content="Preparation   OpenHFT/Chronicle-Map
  OpenHFT/Chronicle-Map Replication
     Design Overview   Each Chronicle Map is split into N completely independent, ordered segments
  the number of segments is chosen during the Chronicle Map creation and is never changed.
  each segment has an associated 3-level lock (the read, update and write levels).
     Query Flow
 Compute the hash code of the queried key."><meta property=og:type content=article><meta property=og:url content=https://yimin.io/post/tech/openhft-chronicle-map-data-store-specification/><meta property=article:published_time content=2018-10-11T17:10:23&#43;08:00><meta property=article:modified_time content=2018-10-12T19:53:01&#43;08:00><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/assets/css/style.css><script type=text/javascript src=/js/scripts.js></script><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><nav class=menu><ul class=menu__list><li class=menu__item><a class=menu__link href=/agenda/>Agenda</a></li><li class=menu__item><a class=menu__link href=/>Home</a></li><li class=menu__item><a class=menu__link href=/me/>Mee</a></li><li class=menu__item><a class=menu__link href=/post/>Posts</a></li><li class=menu__item><a class=menu__link href=/wikipedia/>Wikipedia</a></li></ul></nav></header><div class="wrapper flex"><section class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Openhft Chronicle Map Data Store Specification</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 16 16"><path d="m8-3e-7c-4.4.0-8 3.6-8 8C0 12.4 3.6 16 8 16c4.4.0 8-3.6 8-8.0000003.0-4.4-3.6-8-8-8zM8 14.4c-3.52.0-6.4-2.88-6.4-6.4000003.0-3.52 2.88-6.4 6.4-6.4 3.52.0 6.4 2.88 6.4 6.4C14.4 11.52 11.52 14.4 8 14.4zm.4-10.4000003H7.2v4.8l4.16 2.5600003.64-1.04-3.6-2.1600003z"/></svg><time class=meta__text datetime=2018-10-11T17:10:23>October 11, 2018</time>
<time class=meta__text datetime=2018-10-12T19:53:01>(Last Modified: October 12, 2018)</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=/categories/tech rel=category>tech</a></span></div></div></header><div class="content post__content clearfix"><div class=sect1><h2 id=_preparation>Preparation</h2><div class=sectionbody><div class=ulist><ul><li><p><a href=/post/tech/openhft-chronicle-map/>OpenHFT/Chronicle-Map</a></p></li><li><p><a href=/post/tech/openhft-chronicle-map-replication/>OpenHFT/Chronicle-Map Replication</a></p></li></ul></div></div></div><div class=sect1><h2 id=_design_overview>Design Overview</h2><div class=sectionbody><div class=ulist><ul><li><p><strong>Each Chronicle Map is split into N completely independent, ordered segments</strong></p><div class=ulist><ul><li><p>the number of segments is chosen during the Chronicle Map creation and is never changed.</p></li><li><p>each segment has an associated 3-level lock (the read, update and write levels).</p></li></ul></div></li><li><p><strong>Query Flow</strong></p><div class="olist arabic"><ol class=arabic><li><p>Compute the hash code of the queried key. Hash code length is 64 bits.</p></li><li><p>Identify the segment that should hold the key, based on the hash code.</p></li><li><p>Acquire the segment lock on the needed level.</p></li><li><p>Search for the entry with the queried key in the segment.</p></li><li><p>Perform the actual query operation on the entry, if the entry is found (e. g. read the value, update the value, etc.), or insert the entry, if the queried key was absent in the segment, and insertion of a previously absent entry is implied by the logic of the query being performed.</p></li><li><p>Release the segment lock.</p></li></ol></div></li></ul></div></div></div><div class=sect1><h2 id=_lock_implementation>Lock implementation</h2><div class=sectionbody><div class=paragraph><p>Each lock is represented by two 32-bit words in the Chronicle Map memory</p></div><div class=ulist><ul><li><p><code><em>Count word</em>:</code> holds the numbers of threads holding the lock at the moment on the read, update and write levels.</p></li><li><p><code><em>Wait word</em>:</code> holds the number of pending threads, trying to acquire the lock on the write level, at the moment.</p></li><li><p>These two words are updated only via compare-and-swap operations.</p></li></ul></div><div class=paragraph><p><a href=https://github.com/OpenHFT/Chronicle-Map/blob/master/spec/3_2-lock-structure.md>read more information</a></p></div></div></div><div class=sect1><h2 id=_the_segment_data_structure>The segment data structure</h2><div class=sectionbody><div class=ulist><ul><li><p><strong>Segment tier</strong>
A segment tier basically consists of two parts:</p><div class=ulist><ul><li><p><strong>Hash lookup</strong></p></li><li><p><strong>entry space</strong></p></li></ul></div></li><li><p><strong>Tier chaining</strong></p></li></ul></div><div class=paragraph><p>If a segment tier is filled up, i. e. on some entry insertion request entry space fails to allocate a memory block sufficient to place the new entry, a whole new segment tier is allocated and chained after the previous tier. All tiers, either first in their segments or chained, are identical.</p></div></div></div><div class=sect1><h2 id=_initialization>Initialization</h2><div class=sectionbody><div class=paragraph><p><a href=https://github.com/OpenHFT/Chronicle-Map/blob/master/spec/5-initialization.md>read more information</a></p></div></div></div><div class=sect1><h2 id=_query_operations>Query Operations</h2><div class=sectionbody><div class=paragraph><p><a href=https://github.com/OpenHFT/Chronicle-Map/blob/master/spec/6-queries.md>read more information</a></p></div></div></div></div><div class="post__tags tags clearfix"><svg class="icon icon-tag" width="16" height="16" viewBox="0 0 16 16"><path d="M16 9.5c0 .373-.24.74-.5 1l-5 5c-.275.26-.634.5-1 .5-.373.0-.74-.24-1-.5L1 8a2.853 2.853.0 0 1-.7-1C.113 6.55.0 5.973.0 5.6V1.4C0 1.034.134.669.401.401.67.134 1.034.0 1.4.0h4.2c.373.0.95.113 1.4.3.45.187.732.432 1 .7l7.5 7.502c.26.274.5.632.5.998zM3.5 5a1.5 1.5.0 1 0 0-3 1.5 1.5.0 0 0 0 3z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/tech/ rel=tag>tech</a></li><li class=tags__item><a class="tags__link btn" href=/tags/java/ rel=tag>java</a></li></ul></div></article></main><div class="authorbox clearfix"><figure class=authorbox__avatar><img alt="yimin avatar" src=/favicon.ico class=avatar height=90 width=90></figure><div class=authorbox__header><span class=authorbox__name>About yimin</span></div><div class=authorbox__description>Ordinary steps can also take a great trip.</div></div><nav class="post-nav flex"><div class="post-nav__item post-nav__item--prev"><a class=post-nav__link href=/post/tech/openhft-chronicle-map-replication/ rel=prev><span class=post-nav__caption>«&thinsp;Previous</span><p class=post-nav__post-title>OpenHFT/Chronicle-Map Replication</p></a></div><div class="post-nav__item post-nav__item--next"><a class=post-nav__link href=/post/life/one-thing-beijing-zoom-20181013/ rel=next><span class=post-nav__caption>Next&thinsp;»</span><p class=post-nav__post-title>北京动物园事件 - 2018/10/13</p></a></div></nav></section></div><footer class=footer><div class=container><div class=footer__copyright>&copy; 2018 &amp;copy;2018 Yimin. <span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/gardenias/ rel="nofollow noopener" target=_blank>Gardenias</a> theme.</span></div></div></footer></div><script>var navigation=responsiveNav(".menu",{navClass:"menu--collapse",label:"Menu",});</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script></body></html>